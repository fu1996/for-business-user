# 如何一套前端代码满足多个客户的定制化需求

## 业务场景——不服务于业务的代码都是耍流氓

假设有 **三** 位客户，为了便于区分，就叫**甲，乙，丙**吧，突然有一天客户经理收到 **甲客户** 的诉求说 产品的主线上的这块业务逻辑 和 他们公司的实际情况 有些出入，需要进行定制化处理。在你收到反馈以后，发现业务改动不是很多，并且改动量不是很大，当下就 基于 **master** 切了一个 **feature-jia-baba** 分支，10 分钟代码改完提交测试。测试通过，给客户甲 安排了 上线，随后 收到客户甲的 表扬信，夸赞你效率高。

过了两天，**客户乙** 提了 一个新的需求，经过讨论对接开始进行迭代开发，开发完毕以后 **合入 master** 安排 上线。过了两天 客户甲 也想要 主线上的 这个功能，脑壳一想，此时有两种解决方案：1. Cherry-pick 之前的 功能提交 2. **feature-jia-baba** 分支拉取一下最新的 master。

又过了两天，**客户丙** 说 之前给客户甲上线的功能 我也要，并且我这边还要增加需求，老办法 基于 **feature-jia-baba** 分支 拉了一个 **feature-jia-bing-baba** 分支,吭哧吭哧一顿提交。又满足了**客户丙**的需求。

（上面的都是基于 git 分支模型，建立的为了满足不同客户需求分支管理模型）

当你在主线 master 进行开发的时候，迭代了 N 个需求，每次 给客户甲上线的时候都要 **feature-jia-baba** 分支 和 **master 分支**合入一次，再发包给甲客户。给丙上线的时候 也是 要 **feature-jia-bing-baba** 分支 和 **master 分支** 合入一次，发包给丙客户。某天来了新同事，忘记了上面的规范，直接把 **master 分支**的包 都给了 三位客户，第二天新同事 因为右脚踏入公司门被毕业。

## 有没有更好的，更细致的解决方案呢？

0.  git 分支模型：基于客户的需求 进行分支管理，后期客户体量大，定制需求增多的时候，你就开始后悔了。

    - 优点：简单粗暴，立即见效，
    - 缺点：不长远，不是最好的解决方案，只是解决了当下，应归属于 临时解决方案，随着客户体量的增加会导致日常工作在处理分支合并和维护上花费较多时间，造成身心和心理上的疲惫。

1.  因为是前端代码，所以可以在运行时，对 全局对象 window 增加某个客户的专属标识，进而通过环境判断去执行特定的代码。

2.  通过打包工具（如 webpack） 在编译时 就进行 区分打包，使得最后生成的 dist 目录 仅仅是 某位客户的代码。

目前我只想到了以上的 3 种方法，对于具体的业务场景 可以选择其中的 一种 或者 两种方法结合使用。

Git 分支管理模型，没有什么代码层面的知识，只需要操作 git 命令，就可以实现，此处就不细讲了。接下来主要讲剩余两种解决方案。

## 文件夹说明

### 1. 代码级别的变更

- 01-window-user-symbol 使用 window 对象上挂载的用户标识进行条件执行 【运行时判断】【代码级别变更】
- 02-docker 生产情况下使用 docker -v 模式实现用户标识切换 【运行时判断】【代码级别变更】
- 03-webpack-loadjs-demo 在使用 react 框架的情况下， 结合 loadjs 实现用户标识文件的加载 【运行时判断】【代码级别变更】
- 04-webpack-demo 使用 webpack DefinePlugin 增加用户标识 进行条件编译 【编译时判断】【代码级别变更】

### 2. 文件级别的变更

- 05-webpack-resolve-mode 结合`@fu1996/webapck-resolver-mode-plugin`实现文件级别的区分 【编译时】【文件级别变更】

## 相关的文档

https://juejin.cn/post/7196494458539933754
